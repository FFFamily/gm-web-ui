# 后台「用户体系」前端接口清单（基础版）

> 依据：`doc/用户体系前端页面清单.md`、后端 `gm-api` 模块 Controller 路由。
>
> 通用返回：`ApiResponse<T>`（字段：`code`、`message`、`data`）。
>
> 通用认证：除登录接口外，其余接口需要携带 Sa-Token（默认 header/cookie 名：`satoken`）。

## 0. 登录

1) 登录
- 方法：`POST /api/auth/login`
- Body：
  - `username` string
  - `password` string
- 返回：
  - `data.token` string
- 说明：失败统一提示（不区分用户不存在/密码错误）

2) 当前用户信息（用于前端菜单/按钮权限控制）
- 方法：`GET /api/auth/me`
- 返回：`data` 为 `AuthMeDto`
  - `id` number
  - `username` string
  - `displayName` string
  - `roleCodes` string[]
  - `permCodes` string[]
  - `isAdmin` boolean（可选）

## 1. 用户管理

3) 用户列表
- 方法：`GET /api/users`
- 权限：`user:list`
- Query：
  - `page` number（默认 1）
  - `size` number（默认 20，最大 200）
  - `keyword` string（可选，匹配 username/displayName）
  - `enabled` boolean（可选）
- 返回：`data` 为分页对象 `PageResult<UserDto>`（`records/total/page/size`）

4) 用户详情
- 方法：`GET /api/users/{id}`
- 权限：`user:read`
- 返回：`data` 为 `UserDetailDto`（包含 `roleCodes`）

5) 新增用户
- 方法：`POST /api/users`
- 权限：`user:create`
- Body：
  - `username` string
  - `displayName` string
  - `password` string（初始密码）
  - `enabled` boolean
  - `roleCodes` string[]（可选）
- 返回：`data` 为 `UserDetailDto`

6) 编辑用户
- 方法：`PUT /api/users/{id}`
- 权限：`user:update`
- Body：
  - `displayName` string
  - `enabled` boolean
  - `roleCodes` string[]（可选）
- 返回：`data` 为 `UserDetailDto`

7) 重置用户密码
- 方法：`POST /api/users/{id}/reset-password`
- 权限：`user:reset_password`
- 返回：
  - `data.tempPassword` string（临时密码，一次性展示用）

8) 前台用户列表（Account）
- 方法：`GET /api/accounts`
- 权限：`account:list`
- Query：
  - `page` number（默认 1）
  - `size` number（默认 20，最大 200）
  - `keyword` string（可选，匹配 username/displayName）
  - `enabled` boolean（可选）
- 返回：`data` 为分页对象 `PageResult<AdminAccountDto>`

9) 前台用户更新（启用/禁用/改显示名）
- 方法：`PUT /api/accounts/{id}`
- 权限：`account:update`
- Body：
  - `displayName` string
  - `enabled` boolean
- 返回：`data` 为 `AdminAccountDetailDto`

10) 前台用户重置密码
- 方法：`POST /api/accounts/{id}/reset-password`
- 权限：`account:reset_password`
- 返回：
  - `data.tempPassword` string

## 2. 角色与权限

11) 角色列表（用于用户新增/编辑时选择角色）
- 方法：`GET /api/roles`
- 权限：`role:list`
- Query：
  - `page` number（默认 1）
  - `size` number（默认 50，最大 200）
- 返回：`data` 为分页对象 `PageResult<RoleDto>`

12) 角色详情（用于查看已绑定权限）
- 方法：`GET /api/roles/{id}`
- 权限：`role:read`
- 返回：`data` 为 `RoleDetailDto`（包含 `permCodes`）

13) 新增角色
- 方法：`POST /api/roles`
- 权限：`role:create`
- Body：
  - `roleCode` string
  - `roleName` string
- 返回：`data` 为 `RoleDetailDto`

14) 编辑角色
- 方法：`PUT /api/roles/{id}`
- 权限：`role:update`
- Body：
  - `roleName` string
- 返回：`data` 为 `RoleDetailDto`

15) 删除角色
- 方法：`DELETE /api/roles/{id}`
- 权限：`role:delete`
- 返回：`data` 为 `null`
- 说明：后端禁止删除 `ADMIN` 角色，前端建议置灰/隐藏该操作

16) 角色绑定权限
- 方法：`POST /api/roles/{id}/permissions`
- 权限：`role:bind_permissions`
- Body：
  - `permCodes` string[]（允许传空数组表示清空）
- 返回：`data` 为 `RoleDetailDto`

17) 权限点列表（用于角色绑定权限的候选列表）
- 方法：`GET /api/permissions`
- 权限：`permission:list`
- 返回：`data` 为 `PermissionDto[]`

## 3. 审计日志

18) 审计日志列表
- 方法：`GET /api/audits`
- 权限：`audit:list`
- Query：
  - `page` number（默认 1）
  - `size` number（默认 20，最大 200）
  - `actorUserId` number（可选）
  - `action` string（可选）
  - `targetType` string（可选）
  - `startAt` string（可选，ISO-8601 datetime）
  - `endAt` string（可选，ISO-8601 datetime）
- 返回：`data` 为分页对象 `PageResult<AuditLogDto>`

## 4. 前台 Account（无权限）

> Account 为前台账号体系：只做登录态，不做 RBAC 权限点控制。

19) 前台账号登录
- 方法：`POST /api/account/login`
- Body：
  - `username` string
  - `password` string
- 返回：
  - `data.token` string

20) 前台账号当前用户
- 方法：`GET /api/account/me`
- 返回：`data` 为 `AccountMeDto`
  - `id` number
  - `username` string
  - `displayName` string

21) 前台账号退出登录
- 方法：`POST /api/account/logout`
- 返回：`data` 为 `null`

22) 前台账号更新基本信息
- 方法：`PUT /api/account/me`
- Body：
  - `displayName` string
- 返回：`data` 为 `AccountMeDto`

23) 前台账号注册（注册后自动登录）
- 方法：`POST /api/account/register`
- Body：
  - `username` string
  - `password` string
  - `displayName` string（可选；为空则默认使用 username）
- 返回：
  - `data.token` string

## 4. 前端通用约定（建议）

- token 传递：
  - Header：`satoken: <token>`（或 Sa-Token 支持的其他方式）
- 统一错误处理：
  - `401`：跳转登录
  - `403`：提示无权限
  - `code != 0`：按 `message` toast 提示
